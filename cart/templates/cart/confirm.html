{% extends "core/base.html" %}
{% block title %}Payment Success{% endblock %}

{% block content %}
<div class="min-h-screen bg-purple-50 py-8 px-4"> <!-- Purple background container -->
  <div class="max-w-md mx-auto bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
    <!-- Receipt Header -->
    <div id="receipt" class="space-y-4">
      <div class="text-center">
        <h1 class="text-xl sm:text-2xl font-bold text-green-600 mb-2">PAYMENT SUCCESSFUL</h1>
        <p class="text-gray-600 text-sm sm:text-base">ORDER #{{ order.order_number }}</p>
      </div>

      <!-- Customer Info -->
      <div class="border-b border-gray-300 pb-4">
        {% if order.name %}<p class="mb-1 text-sm sm:text-base"><span class="font-semibold">Name:</span> {{ order.name }}</p>{% endif %}
        {% if order.phone %}<p class="mb-1 text-sm sm:text-base"><span class="font-semibold">Phone:</span> {{ order.phone }}</p>{% endif %}
        {% if order.email %}<p class="mb-1 text-sm sm:text-base"><span class="font-semibold">Email:</span> {{ order.email }}</p>{% endif %}
        <p class="text-gray-800 text-sm sm:text-base"><span class="font-semibold">Date:</span> {{ date }} at {{ time }}</p>
      </div>

      <!-- Order Items -->
      <table class="w-full">
        <thead>
          <tr class="border-b border-gray-300">
            <th class="text-left pb-2 text-sm sm:text-base font-semibold">Item</th>
            <th class="text-right pb-2 text-sm sm:text-base font-semibold">Price</th>
          </tr>
        </thead>
        <tbody>
          {% for item in checkout_items %}
          <tr class="border-b border-gray-200">
            <td class="py-2 text-sm sm:text-base">{{ item.quantity }} Ã— {{ item.item.name }}</td>
            <td class="text-right text-sm sm:text-base">ETB {{ item.subtotal|floatformat:2 }}</td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <td class="pt-2 text-sm sm:text-base font-semibold">Total</td>
            <td class="text-right pt-2 text-base sm:text-lg font-semibold">ETB {{ total|floatformat:2 }}</td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Actions - Buttons in one line with colorful backgrounds -->
    <div class="flex flex-row justify-between gap-3 mt-6">
      <a href="{% url 'home_view' %}" class="flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white text-center rounded-lg transition-colors">
        Back to Shopping
      </a>
      <button onclick="printReceipt()" class="flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors">
        Print Receipt
      </button>
    </div>
  </div>
</div>

<script>
  function printReceipt() {
    const receipt = document.getElementById("receipt").innerHTML;
    const printWindow = window.open('', '', 'width=600,height=600');
    printWindow.document.write(`
      <html>
        <head>
          <title>Receipt #{{ order.order_number }}</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 20px; }
            table { width: 100%; border-collapse: collapse; }
            th, td { padding: 5px; text-align: left; }
            .border-bottom { border-bottom: 1px solid #000; }
            .text-right { text-align: right; }
            .font-bold { font-weight: bold; }
          </style>
        </head>
        <body>
          <h2 style="text-align:center;font-weight:bold">OFFICIAL RECEIPT</h2>
          <hr>
          ${receipt.replace(/class="[^"]*"/g, '')}
          <hr>
          <p style="text-align:center">Thank you for your business!</p>
        </body>
      </html>
    `);
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
  }
</script>
{% endblock %}